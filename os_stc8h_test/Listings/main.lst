C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\XmRTOS) DEBUG OBJECTEXTEN
                    -D CODE PRINT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

*** WARNING C500 IN LINE 1 OF main.c: LICENSE ERROR (R207(3): REGISTRY READ ERROR)

   1          /*
   2          标题：LED红绿灯系统
   3          主频：35MHz
   4          用于：51单片机学习机-学电 
   5          资料：https://rationmcu.com
   6          */
   7          
   8          #include "stc8g.h"
   9          #include "intrins.h"
  10          #include "stdio.h"
  11          
  12          #include "os_typedef.h"
  13          
  14          /* 发光二极管定义 */
  15          sbit LED_R = P0^5;    // 红色LED
  16          sbit LED_Y = P0^6;    // 黄色LED
  17          sbit LED_G = P0^7;    // 绿色LED
  18          
  19          /* 固定延时1毫秒 @35MHz*/
  20          void Delay1ms()         //@35MHz 
  21          {
  22   1              unsigned char i, j;
  23   1              
  24   1              _nop_();
  25   1              _nop_();
  26   1              i = 46;
  27   1              j = 113;
  28   1              do
  29   1              {
  30   2                      while (--j);
  31   2              } while (--i);
  32   1      }
  33          
  34          /* n毫秒延时函数 参数给几 就延时几毫秒 */
  35          void delay_ms(unsigned int ms) 
  36          {
  37   1              while(ms--)
  38   1              {
  39   2                      Delay1ms();
  40   2              }
  41   1      }
  42          
  43           
  44          #define MAX_TASKS 5       /*任务槽个数.必须和实际任务数一至*/
  45          #define MAX_TASK_DEP 20   /*最大栈深.最低不得少于2个,保守值为12*/
  46          unsigned int task_id;    /*当前活动任务号*/
  47          unsigned int max_task = 0;
  48           
  49          // 任务控制列表
  50          struct os_tcb_t idata tcb_list[MAX_TASKS];
  51          
  52          os_uint8_t idata task_idle_stack[MAX_TASK_DEP];         /*空闲任务堆栈.*/
  53          
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 2   

  54          os_uint8_t idata task_stack1[MAX_TASK_DEP];                     /*任务1堆栈.*/
  55          os_uint8_t idata task_stack2[MAX_TASK_DEP];                     /*任务2堆栈.*/
  56          
  57          // 任务切换函数
  58          void OSCtxSw()
  59          {
  60   1              os_uint8_t  ost_i = 0;
  61   1              tcb_list[task_id].sp = SP;
  62   1              // 找出就绪态的一个id
  63   1              for(ost_i = 0; ost_i < max_task; ost_i++)
  64   1              {
  65   2                      if(tcb_list[ost_i].os_status_type == OS_READY)
  66   2                      {
  67   3                              task_id = ost_i;
  68   3                              continue;
  69   3      
  70   3                      }
  71   2              }
  72   1              
  73   1              
  74   1          if(task_id == max_task)
  75   1              {
  76   2                      task_id = 0;
  77   2              }
  78   1      
  79   1          SP = tcb_list[task_id].sp;
  80   1      
  81   1      }
  82           
  83          void os_task_create(void(*task)(void) ,os_uint8_t *tstack,int tid)
  84          {
  85   1      
  86   1              tstack[0] = (unsigned int)task & 0xff;
  87   1              tstack[1] = (unsigned int)task >> 8;
  88   1      
  89   1              tcb_list[tid].sp                                = tstack+1;
*** WARNING C260 IN LINE 89 OF main.c: '=': pointer truncation
  90   1              tcb_list[tid].os_status_type    = OS_READY;
  91   1      
  92   1              ++max_task;
  93   1      }
  94          void os_idle_task(void);
  95          
  96          void os_start()
  97          {
  98   1              // 装载空闲任务
  99   1              os_task_create(os_idle_task, &task_idle_stack, 0);//将task1函数装入0号槽
 100   1      
 101   1              task_id = 0;
 102   1              SP = tcb_list[task_id].sp;  
 103   1              return;
 104   1      }
 105          
 106          // 任务延时函数
 107          void os_delay(os_uint32_t tasks)
 108          {       
 109   1              
 110   1              // 设置延时滴答数
 111   1              tcb_list[task_id].delay_tick     =      tasks;
 112   1              // 将任务设置为阻塞态
 113   1              tcb_list[task_id].os_status_type =      OS_BLOCKED;
 114   1              // 只要任务延时了，就马上切换出去
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 3   

 115   1              OSCtxSw();
 116   1              
 117   1      }
 118          // 空闲函数
 119          void os_idle_task(void)
 120          {
 121   1              while(1)
 122   1              {
 123   2                      OSCtxSw();
 124   2              }
 125   1      }
 126          
 127          void task1()
 128          {
 129   1              unsigned int task1_i = 0;
 130   1      
 131   1              while(1)
 132   1              {
 133   2                      LED_R = 1;
 134   2                      os_delay(500);
 135   2      
 136   2                      LED_R = 0;
 137   2                      os_delay(500);
 138   2      
 139   2                      task1_i ++;
 140   2                      task1_i / 120;
*** WARNING C275 IN LINE 140 OF main.c: expression with possibly no effect
 141   2                      OSCtxSw();
 142   2              }
 143   1      }
 144          
 145          void task2()
 146          {
 147   1      
 148   1              unsigned int task2_i = 0;
 149   1      
 150   1              while(1)
 151   1              {
 152   2      
 153   2                      LED_Y = !LED_Y;
 154   2                      task2_i ++;
 155   2                      task2_i / 120;
*** WARNING C275 IN LINE 155 OF main.c: expression with possibly no effect
 156   2                      task2_i * 120;
*** WARNING C275 IN LINE 156 OF main.c: expression with possibly no effect
 157   2                      task2_i % 120;
*** WARNING C275 IN LINE 157 OF main.c: expression with possibly no effect
 158   2      
 159   2                      os_delay(5000);
 160   2                      OSCtxSw();
 161   2              }
 162   1      }
 163          
 164          
 165          unsigned int cut = 0;
 166          
 167          void Timer0_Isr(void) interrupt 1
 168          {
 169   1              os_uint8_t ti = 0;
 170   1              cut++;
 171   1      
 172   1              if(cut == 500)
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 4   

 173   1              {
 174   2                      cut = 0;
 175   2                      LED_G = !LED_G;
 176   2              }
 177   1              // 在这里处理遍历延时
 178   1              for(ti = 0; ti<max_task; ti++)
 179   1              {
 180   2                      if(tcb_list[ti].os_status_type != OS_BLOCKED)
 181   2                      {
 182   3                              continue;
 183   3                      }
 184   2                      // 设置延时滴答数
 185   2                      if((tcb_list[ti].delay_tick - 1) == 0)
 186   2                      {
 187   3                              tcb_list[ti].delay_tick = 0;
 188   3                              // 将任务设置为阻塞态
 189   3                              tcb_list[ti].os_status_type = OS_READY;
 190   3                              continue;
 191   3                      }
 192   2                      tcb_list[ti].delay_tick--;
 193   2              }
 194   1      }
 195          
 196          void Timer0_Init(void)          //1毫秒@11.0592MHz
 197          {
 198   1              AUXR |= 0x80;                   //定时器时钟1T模式
 199   1              TMOD &= 0xF0;                   //设置定时器模式
 200   1              TL0 = 0xCD;                             //设置定时初始值
 201   1              TH0 = 0xD4;                             //设置定时初始值
 202   1              TF0 = 0;                                //清除TF0标志
 203   1              TR0 = 1;                                //定时器0开始计时
 204   1              ET0 = 1;                                //使能定时器0中断
 205   1      }
 206          
 207          
 208          /* 主函数 */
 209          void main()
 210          {
 211   1              P0M0 = 0x00;   //设置P0.0~P0.7为双向口模式
 212   1              P0M1 = 0x00;
 213   1              Timer0_Init();
 214   1              EA = 1;
 215   1              P_SW2 |= (1<<7);
 216   1              
 217   1              
 218   1              os_task_create(task1, &task_stack1, 1);//将task1函数装入0号槽
 219   1              os_task_create(task2, &task_stack2, 2);//将task2函数装入1号槽
 220   1              os_start();
 221   1      
 222   1      
 223   1              while(1)
 224   1              {
 225   2      
 226   2              }
 227   1              
 228   1      
 229   1      }
 230          
 231          
 232          
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 5   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Delay1ms (BEGIN)
                                           ; SOURCE LINE # 20
                                           ; SOURCE LINE # 21
                                           ; SOURCE LINE # 24
0000 00                NOP     
                                           ; SOURCE LINE # 25
0001 00                NOP     
                                           ; SOURCE LINE # 26
;---- Variable 'i' assigned to Register 'R7' ----
0002 7F2E              MOV     R7,#02EH
                                           ; SOURCE LINE # 27
;---- Variable 'j' assigned to Register 'R6' ----
0004 7E71              MOV     R6,#071H
                                           ; SOURCE LINE # 29
0006         ?C0004:
                                           ; SOURCE LINE # 30
0006 DEFE              DJNZ    R6,?C0004
                                           ; SOURCE LINE # 31
0008 DFFC              DJNZ    R7,?C0004
                                           ; SOURCE LINE # 32
000A 22                RET     
             ; FUNCTION Delay1ms (END)

             ; FUNCTION _delay_ms (BEGIN)
                                           ; SOURCE LINE # 35
;---- Variable 'ms' assigned to Register 'R4/R5' ----
0000 AD07              MOV     R5,AR7
0002 AC06              MOV     R4,AR6
                                           ; SOURCE LINE # 36
0004         ?C0007:
                                           ; SOURCE LINE # 37
0004 ED                MOV     A,R5
0005 1D                DEC     R5
0006 AE04              MOV     R6,AR4
0008 7001              JNZ     ?C0039
000A 1C                DEC     R4
000B         ?C0039:
000B 4E                ORL     A,R6
000C 6005              JZ      ?C0009
                                           ; SOURCE LINE # 38
                                           ; SOURCE LINE # 39
000E 120000      R     LCALL   Delay1ms
                                           ; SOURCE LINE # 40
0011 80F1              SJMP    ?C0007
                                           ; SOURCE LINE # 41
0013         ?C0009:
0013 22                RET     
             ; FUNCTION _delay_ms (END)

             ; FUNCTION OSCtxSw (BEGIN)
                                           ; SOURCE LINE # 58
                                           ; SOURCE LINE # 59
                                           ; SOURCE LINE # 60
;---- Variable 'ost_i' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
                                           ; SOURCE LINE # 61
0002 900000      R     MOV     DPTR,#task_id
0005 A3                INC     DPTR
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 6   

0006 E0                MOVX    A,@DPTR
0007 75F006            MOV     B,#06H
000A A4                MUL     AB
000B 2400        R     ADD     A,#LOW tcb_list
000D F8                MOV     R0,A
000E A681              MOV     @R0,SP
                                           ; SOURCE LINE # 63
0010         ?C0010:
0010 EF                MOV     A,R7
0011 FD                MOV     R5,A
0012 D3                SETB    C
0013 900000      R     MOV     DPTR,#max_task+01H
0016 E0                MOVX    A,@DPTR
0017 9D                SUBB    A,R5
0018 900000      R     MOV     DPTR,#max_task
001B E0                MOVX    A,@DPTR
001C 9400              SUBB    A,#00H
001E 4017              JC      ?C0011
                                           ; SOURCE LINE # 64
                                           ; SOURCE LINE # 65
0020 EF                MOV     A,R7
0021 75F006            MOV     B,#06H
0024 A4                MUL     AB
0025 2400        R     ADD     A,#LOW tcb_list+05H
0027 F8                MOV     R0,A
0028 E6                MOV     A,@R0
0029 B40108            CJNE    A,#01H,?C0012
                                           ; SOURCE LINE # 66
                                           ; SOURCE LINE # 67
002C 900000      R     MOV     DPTR,#task_id
002F E4                CLR     A
0030 F0                MOVX    @DPTR,A
0031 A3                INC     DPTR
0032 ED                MOV     A,R5
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 68
                                           ; SOURCE LINE # 70
                                           ; SOURCE LINE # 71
0034         ?C0012:
0034 0F                INC     R7
0035 80D9              SJMP    ?C0010
0037         ?C0011:
                                           ; SOURCE LINE # 74
0037 900000      R     MOV     DPTR,#max_task
003A E0                MOVX    A,@DPTR
003B FE                MOV     R6,A
003C A3                INC     DPTR
003D E0                MOVX    A,@DPTR
003E FF                MOV     R7,A
003F A3                INC     DPTR
0040 E0                MOVX    A,@DPTR
0041 B5060C            CJNE    A,AR6,?C0014
0044 A3                INC     DPTR
0045 E0                MOVX    A,@DPTR
0046 B50707            CJNE    A,AR7,?C0014
                                           ; SOURCE LINE # 75
                                           ; SOURCE LINE # 76
0049 E4                CLR     A
004A 900000      R     MOV     DPTR,#task_id
004D F0                MOVX    @DPTR,A
004E A3                INC     DPTR
004F F0                MOVX    @DPTR,A
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 7   

                                           ; SOURCE LINE # 77
0050         ?C0014:
                                           ; SOURCE LINE # 79
0050 900000      R     MOV     DPTR,#task_id
0053 A3                INC     DPTR
0054 E0                MOVX    A,@DPTR
0055 75F006            MOV     B,#06H
0058 A4                MUL     AB
0059 2400        R     ADD     A,#LOW tcb_list
005B F8                MOV     R0,A
005C E6                MOV     A,@R0
005D F581              MOV     SP,A
                                           ; SOURCE LINE # 81
005F 22                RET     
             ; FUNCTION OSCtxSw (END)

             ; FUNCTION _os_task_create (BEGIN)
                                           ; SOURCE LINE # 83
0000 900000      R     MOV     DPTR,#task
0003 EB                MOV     A,R3
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EA                MOV     A,R2
0007 F0                MOVX    @DPTR,A
0008 A3                INC     DPTR
0009 E9                MOV     A,R1
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 84
                                           ; SOURCE LINE # 86
000B 900000      R     MOV     DPTR,#task
000E A3                INC     DPTR
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011 FF                MOV     R7,A
0012 A3                INC     DPTR
0013 E0                MOVX    A,@DPTR
0014 FB                MOV     R3,A
0015 A3                INC     DPTR
0016 E0                MOVX    A,@DPTR
0017 FA                MOV     R2,A
0018 A3                INC     DPTR
0019 E0                MOVX    A,@DPTR
001A F9                MOV     R1,A
001B EF                MOV     A,R7
001C 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 87
001F 900000      R     MOV     DPTR,#task
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 FA                MOV     R2,A
0025 A3                INC     DPTR
0026 EA                MOV     A,R2
0027 FF                MOV     R7,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
002A FB                MOV     R3,A
002B A3                INC     DPTR
002C E0                MOVX    A,@DPTR
002D FA                MOV     R2,A
002E A3                INC     DPTR
002F E0                MOVX    A,@DPTR
0030 F9                MOV     R1,A
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 8   

0031 900001            MOV     DPTR,#01H
0034 EF                MOV     A,R7
0035 120000      E     LCALL   ?C?CSTOPTR
                                           ; SOURCE LINE # 89
0038 E9                MOV     A,R1
0039 2401              ADD     A,#01H
003B F9                MOV     R1,A
003C 900000      R     MOV     DPTR,#tid
003F A3                INC     DPTR
0040 E0                MOVX    A,@DPTR
0041 FE                MOV     R6,A
0042 75F006            MOV     B,#06H
0045 A4                MUL     AB
0046 2400        R     ADD     A,#LOW tcb_list
0048 F8                MOV     R0,A
0049 A601              MOV     @R0,AR1
                                           ; SOURCE LINE # 90
004B EE                MOV     A,R6
004C 75F006            MOV     B,#06H
004F A4                MUL     AB
0050 2400        R     ADD     A,#LOW tcb_list+05H
0052 F8                MOV     R0,A
0053 7601              MOV     @R0,#01H
                                           ; SOURCE LINE # 92
0055 900000      R     MOV     DPTR,#max_task+01H
0058 E0                MOVX    A,@DPTR
0059 04                INC     A
005A F0                MOVX    @DPTR,A
005B 7006              JNZ     ?C0041
005D 900000      R     MOV     DPTR,#max_task
0060 E0                MOVX    A,@DPTR
0061 04                INC     A
0062 F0                MOVX    @DPTR,A
0063         ?C0041:
                                           ; SOURCE LINE # 93
0063 22                RET     
             ; FUNCTION _os_task_create (END)

             ; FUNCTION os_start (BEGIN)
                                           ; SOURCE LINE # 96
                                           ; SOURCE LINE # 97
                                           ; SOURCE LINE # 99
0000 900000      R     MOV     DPTR,#?_os_task_create?BYTE+03H
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 7400        R     MOV     A,#HIGH task_idle_stack
0008 F0                MOVX    @DPTR,A
0009 A3                INC     DPTR
000A 7400        R     MOV     A,#LOW task_idle_stack
000C F0                MOVX    @DPTR,A
000D E4                CLR     A
000E A3                INC     DPTR
000F F0                MOVX    @DPTR,A
0010 A3                INC     DPTR
0011 F0                MOVX    @DPTR,A
0012 7BFF              MOV     R3,#0FFH
0014 7A00        R     MOV     R2,#HIGH os_idle_task
0016 7900        R     MOV     R1,#LOW os_idle_task
0018 120000      R     LCALL   _os_task_create
                                           ; SOURCE LINE # 101
001B E4                CLR     A
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 9   

001C 900000      R     MOV     DPTR,#task_id
001F F0                MOVX    @DPTR,A
0020 A3                INC     DPTR
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 102
0022 900000      R     MOV     DPTR,#task_id
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 75F006            MOV     B,#06H
002A A4                MUL     AB
002B 2400        R     ADD     A,#LOW tcb_list
002D F8                MOV     R0,A
002E E6                MOV     A,@R0
002F F581              MOV     SP,A
                                           ; SOURCE LINE # 104
0031 22                RET     
             ; FUNCTION os_start (END)

             ; FUNCTION L?0046 (BEGIN)
0000 7FF4              MOV     R7,#0F4H
0002 7E01              MOV     R6,#01H
0004         L?0047:
0004 7D00              MOV     R5,#00H
0006 7C00              MOV     R4,#00H
             ; FUNCTION _os_delay (BEGIN)
                                           ; SOURCE LINE # 107
;---- Variable 'tasks' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 108
                                           ; SOURCE LINE # 111
0008 900000      R     MOV     DPTR,#task_id
000B A3                INC     DPTR
000C E0                MOVX    A,@DPTR
000D FB                MOV     R3,A
000E 75F006            MOV     B,#06H
0011 A4                MUL     AB
0012 2400        R     ADD     A,#LOW tcb_list+01H
0014 F8                MOV     R0,A
0015 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 113
0018 EB                MOV     A,R3
0019 75F006            MOV     B,#06H
001C A4                MUL     AB
001D 2400        R     ADD     A,#LOW tcb_list+05H
001F F8                MOV     R0,A
0020 7603              MOV     @R0,#03H
                                           ; SOURCE LINE # 115
0022 020000      R     LJMP    OSCtxSw
             ; FUNCTION _os_delay (END)

             ; FUNCTION os_idle_task (BEGIN)
                                           ; SOURCE LINE # 119
                                           ; SOURCE LINE # 120
0000         ?C0019:
                                           ; SOURCE LINE # 121
                                           ; SOURCE LINE # 122
                                           ; SOURCE LINE # 123
0000 120000      R     LCALL   OSCtxSw
                                           ; SOURCE LINE # 124
0003 80FB              SJMP    ?C0019
             ; FUNCTION os_idle_task (END)

             ; FUNCTION task1 (BEGIN)
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 10  

                                           ; SOURCE LINE # 127
                                           ; SOURCE LINE # 128
                                           ; SOURCE LINE # 129
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#task1_i
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
0007         ?C0022:
                                           ; SOURCE LINE # 131
                                           ; SOURCE LINE # 132
                                           ; SOURCE LINE # 133
0007 D285              SETB    LED_R
                                           ; SOURCE LINE # 134
0009 120000      R     LCALL   L?0046
                                           ; SOURCE LINE # 136
000C C285              CLR     LED_R
                                           ; SOURCE LINE # 137
000E 120000      R     LCALL   L?0046
                                           ; SOURCE LINE # 139
0011 900000      R     MOV     DPTR,#task1_i+01H
0014 E0                MOVX    A,@DPTR
0015 04                INC     A
0016 F0                MOVX    @DPTR,A
0017 7006              JNZ     ?C0042
0019 900000      R     MOV     DPTR,#task1_i
001C E0                MOVX    A,@DPTR
001D 04                INC     A
001E F0                MOVX    @DPTR,A
001F         ?C0042:
                                           ; SOURCE LINE # 140
                                           ; SOURCE LINE # 141
001F 120000      R     LCALL   OSCtxSw
                                           ; SOURCE LINE # 142
0022 80E3              SJMP    ?C0022
             ; FUNCTION task1 (END)

             ; FUNCTION task2 (BEGIN)
                                           ; SOURCE LINE # 145
                                           ; SOURCE LINE # 146
                                           ; SOURCE LINE # 148
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#task2_i
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
0007         ?C0025:
                                           ; SOURCE LINE # 150
                                           ; SOURCE LINE # 151
                                           ; SOURCE LINE # 153
0007 B286              CPL     LED_Y
                                           ; SOURCE LINE # 154
0009 900000      R     MOV     DPTR,#task2_i+01H
000C E0                MOVX    A,@DPTR
000D 04                INC     A
000E F0                MOVX    @DPTR,A
000F 7006              JNZ     ?C0043
0011 900000      R     MOV     DPTR,#task2_i
0014 E0                MOVX    A,@DPTR
0015 04                INC     A
0016 F0                MOVX    @DPTR,A
0017         ?C0043:
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 11  

                                           ; SOURCE LINE # 155
                                           ; SOURCE LINE # 156
                                           ; SOURCE LINE # 157
                                           ; SOURCE LINE # 159
0017 7F88              MOV     R7,#088H
0019 7E13              MOV     R6,#013H
001B 120000      R     LCALL   L?0047
                                           ; SOURCE LINE # 160
001E 120000      R     LCALL   OSCtxSw
                                           ; SOURCE LINE # 161
0021 80E4              SJMP    ?C0025
             ; FUNCTION task2 (END)

             ; FUNCTION Timer0_Isr (BEGIN)
0000 C0E0              PUSH    ACC
0002 C0F0              PUSH    B
0004 C083              PUSH    DPH
0006 C082              PUSH    DPL
0008 C0D0              PUSH    PSW
000A 75D000            MOV     PSW,#00H
000D C000              PUSH    AR0
000F C001              PUSH    AR1
0011 C002              PUSH    AR2
0013 C003              PUSH    AR3
0015 C004              PUSH    AR4
0017 C005              PUSH    AR5
0019 C006              PUSH    AR6
001B C007              PUSH    AR7
                                           ; SOURCE LINE # 167
                                           ; SOURCE LINE # 169
001D 900000      R     MOV     DPTR,#ti
0020 E4                CLR     A
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 170
0022 900000      R     MOV     DPTR,#cut+01H
0025 E0                MOVX    A,@DPTR
0026 04                INC     A
0027 F0                MOVX    @DPTR,A
0028 7006              JNZ     ?C0044
002A 900000      R     MOV     DPTR,#cut
002D E0                MOVX    A,@DPTR
002E 04                INC     A
002F F0                MOVX    @DPTR,A
0030         ?C0044:
                                           ; SOURCE LINE # 172
0030 900000      R     MOV     DPTR,#cut
0033 E0                MOVX    A,@DPTR
0034 B4010E            CJNE    A,#01H,?C0028
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 B4F409            CJNE    A,#0F4H,?C0028
                                           ; SOURCE LINE # 173
                                           ; SOURCE LINE # 174
003C 900000      R     MOV     DPTR,#cut
003F E4                CLR     A
0040 F0                MOVX    @DPTR,A
0041 A3                INC     DPTR
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 175
0043 B287              CPL     LED_G
                                           ; SOURCE LINE # 176
0045         ?C0028:
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 12  

                                           ; SOURCE LINE # 178
0045 900000      R     MOV     DPTR,#ti
0048 E4                CLR     A
0049 F0                MOVX    @DPTR,A
004A         ?C0029:
004A 900000      R     MOV     DPTR,#ti
004D E0                MOVX    A,@DPTR
004E FF                MOV     R7,A
004F FD                MOV     R5,A
0050 D3                SETB    C
0051 900000      R     MOV     DPTR,#max_task+01H
0054 E0                MOVX    A,@DPTR
0055 9D                SUBB    A,R5
0056 900000      R     MOV     DPTR,#max_task
0059 E0                MOVX    A,@DPTR
005A 9400              SUBB    A,#00H
005C 5003              JNC     $ + 5H
005E 020000      R     LJMP    ?C0034
                                           ; SOURCE LINE # 179
                                           ; SOURCE LINE # 180
0061 EF                MOV     A,R7
0062 75F006            MOV     B,#06H
0065 A4                MUL     AB
0066 2400        R     ADD     A,#LOW tcb_list+05H
0068 F8                MOV     R0,A
0069 E6                MOV     A,@R0
006A 6403              XRL     A,#03H
006C 706F              JNZ     ?C0031
                                           ; SOURCE LINE # 181
                                           ; SOURCE LINE # 182
                                           ; SOURCE LINE # 183
                                           ; SOURCE LINE # 185
006E 900000      R     MOV     DPTR,#ti
0071 E0                MOVX    A,@DPTR
0072 75F006            MOV     B,#06H
0075 A4                MUL     AB
0076 2400        R     ADD     A,#LOW tcb_list+01H
0078 F8                MOV     R0,A
0079 120000      E     LCALL   ?C?LLDIDATA
007C EF                MOV     A,R7
007D 24FF              ADD     A,#0FFH
007F FF                MOV     R7,A
0080 EE                MOV     A,R6
0081 34FF              ADDC    A,#0FFH
0083 FE                MOV     R6,A
0084 ED                MOV     A,R5
0085 34FF              ADDC    A,#0FFH
0087 FD                MOV     R5,A
0088 EC                MOV     A,R4
0089 34FF              ADDC    A,#0FFH
008B FC                MOV     R4,A
008C E4                CLR     A
008D FB                MOV     R3,A
008E FA                MOV     R2,A
008F F9                MOV     R1,A
0090 F8                MOV     R0,A
0091 C3                CLR     C
0092 120000      E     LCALL   ?C?ULCMP
0095 900000      R     MOV     DPTR,#ti
0098 701C              JNZ     ?C0033
                                           ; SOURCE LINE # 186
                                           ; SOURCE LINE # 187
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 13  

009A E0                MOVX    A,@DPTR
009B FB                MOV     R3,A
009C 75F006            MOV     B,#06H
009F A4                MUL     AB
00A0 2400        R     ADD     A,#LOW tcb_list+01H
00A2 F8                MOV     R0,A
00A3 120000      E     LCALL   ?C?LSTKIDATA
00A6 00                DB      00H
00A7 00                DB      00H
00A8 00                DB      00H
00A9 00                DB      00H
                                           ; SOURCE LINE # 189
00AA EB                MOV     A,R3
00AB 75F006            MOV     B,#06H
00AE A4                MUL     AB
00AF 2400        R     ADD     A,#LOW tcb_list+05H
00B1 F8                MOV     R0,A
00B2 7601              MOV     @R0,#01H
                                           ; SOURCE LINE # 190
00B4 8027              SJMP    ?C0031
                                           ; SOURCE LINE # 191
00B6         ?C0033:
                                           ; SOURCE LINE # 192
00B6 E0                MOVX    A,@DPTR
00B7 FB                MOV     R3,A
00B8 75F006            MOV     B,#06H
00BB A4                MUL     AB
00BC 2400        R     ADD     A,#LOW tcb_list+01H
00BE F8                MOV     R0,A
00BF 120000      E     LCALL   ?C?LLDIDATA
00C2 EF                MOV     A,R7
00C3 24FF              ADD     A,#0FFH
00C5 FF                MOV     R7,A
00C6 EE                MOV     A,R6
00C7 34FF              ADDC    A,#0FFH
00C9 FE                MOV     R6,A
00CA ED                MOV     A,R5
00CB 34FF              ADDC    A,#0FFH
00CD FD                MOV     R5,A
00CE EC                MOV     A,R4
00CF 34FF              ADDC    A,#0FFH
00D1 FC                MOV     R4,A
00D2 EB                MOV     A,R3
00D3 75F006            MOV     B,#06H
00D6 A4                MUL     AB
00D7 2400        R     ADD     A,#LOW tcb_list+01H
00D9 F8                MOV     R0,A
00DA 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 193
00DD         ?C0031:
00DD 900000      R     MOV     DPTR,#ti
00E0 E0                MOVX    A,@DPTR
00E1 04                INC     A
00E2 F0                MOVX    @DPTR,A
00E3 020000      R     LJMP    ?C0029
                                           ; SOURCE LINE # 194
00E6         ?C0034:
00E6 D007              POP     AR7
00E8 D006              POP     AR6
00EA D005              POP     AR5
00EC D004              POP     AR4
00EE D003              POP     AR3
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 14  

00F0 D002              POP     AR2
00F2 D001              POP     AR1
00F4 D000              POP     AR0
00F6 D0D0              POP     PSW
00F8 D082              POP     DPL
00FA D083              POP     DPH
00FC D0F0              POP     B
00FE D0E0              POP     ACC
0100 32                RETI    
             ; FUNCTION Timer0_Isr (END)

             ; FUNCTION Timer0_Init (BEGIN)
                                           ; SOURCE LINE # 196
                                           ; SOURCE LINE # 197
                                           ; SOURCE LINE # 198
0000 438E80            ORL     AUXR,#080H
                                           ; SOURCE LINE # 199
0003 5389F0            ANL     TMOD,#0F0H
                                           ; SOURCE LINE # 200
0006 758ACD            MOV     TL0,#0CDH
                                           ; SOURCE LINE # 201
0009 758CD4            MOV     TH0,#0D4H
                                           ; SOURCE LINE # 202
000C C28D              CLR     TF0
                                           ; SOURCE LINE # 203
000E D28C              SETB    TR0
                                           ; SOURCE LINE # 204
0010 D2A9              SETB    ET0
                                           ; SOURCE LINE # 205
0012 22                RET     
             ; FUNCTION Timer0_Init (END)

             ; FUNCTION main (BEGIN)
                                           ; SOURCE LINE # 209
                                           ; SOURCE LINE # 210
                                           ; SOURCE LINE # 211
0000 E4                CLR     A
0001 F594              MOV     P0M0,A
                                           ; SOURCE LINE # 212
0003 F593              MOV     P0M1,A
                                           ; SOURCE LINE # 213
0005 120000      R     LCALL   Timer0_Init
                                           ; SOURCE LINE # 214
0008 D2AF              SETB    EA
                                           ; SOURCE LINE # 215
000A 43BA80            ORL     P_SW2,#080H
                                           ; SOURCE LINE # 218
000D 900000      R     MOV     DPTR,#?_os_task_create?BYTE+03H
0010 F0                MOVX    @DPTR,A
0011 A3                INC     DPTR
0012 7400        R     MOV     A,#HIGH task_stack1
0014 F0                MOVX    @DPTR,A
0015 A3                INC     DPTR
0016 7400        R     MOV     A,#LOW task_stack1
0018 F0                MOVX    @DPTR,A
0019 A3                INC     DPTR
001A E4                CLR     A
001B F0                MOVX    @DPTR,A
001C A3                INC     DPTR
001D 04                INC     A
001E F0                MOVX    @DPTR,A
001F 7BFF              MOV     R3,#0FFH
C51 COMPILER V9.60.7.0   MAIN                                                              12/25/2023 11:11:58 PAGE 15  

0021 7A00        R     MOV     R2,#HIGH task1
0023 7900        R     MOV     R1,#LOW task1
0025 120000      R     LCALL   _os_task_create
                                           ; SOURCE LINE # 219
0028 900000      R     MOV     DPTR,#?_os_task_create?BYTE+03H
002B E4                CLR     A
002C F0                MOVX    @DPTR,A
002D A3                INC     DPTR
002E 7400        R     MOV     A,#HIGH task_stack2
0030 F0                MOVX    @DPTR,A
0031 A3                INC     DPTR
0032 7400        R     MOV     A,#LOW task_stack2
0034 F0                MOVX    @DPTR,A
0035 A3                INC     DPTR
0036 E4                CLR     A
0037 F0                MOVX    @DPTR,A
0038 A3                INC     DPTR
0039 7402              MOV     A,#02H
003B F0                MOVX    @DPTR,A
003C 7BFF              MOV     R3,#0FFH
003E 7A00        R     MOV     R2,#HIGH task2
0040 7900        R     MOV     R1,#LOW task2
0042 120000      R     LCALL   _os_task_create
                                           ; SOURCE LINE # 220
0045 120000      R     LCALL   os_start
0048         ?C0036:
                                           ; SOURCE LINE # 223
                                           ; SOURCE LINE # 224
                                           ; SOURCE LINE # 226
0048 80FE              SJMP    ?C0036
             ; FUNCTION main (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    740    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6      13
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     90    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  6 WARNING(S),  0 ERROR(S)
