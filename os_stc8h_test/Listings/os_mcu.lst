A51 MACRO ASSEMBLER  OS_MCU                                                               12/26/2023 17:25:07 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\os_mcu.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE XmRTOS\os_mcu.asm SET(LARGE) DEBUG PRINT(.\Listings\os_mcu.lst) OBJECT(
                      .\Objects\os_mcu.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     NAME    OS_CPU_A_ASM    ; ¶¨ÒåÒ»¸öÃû³ÆÎª ¡°OS_CPU_A_ASM¡±»ã±à¶Î
                       2     
                       3     ?PR?test?OS_CPU_A_ASM                   SEGMENT CODE ; Õâ¾äÓ¦¸ÃÊÇ ÔÚ OS_CPU_A_ASM¶ËÀïÃæÓÐÒ»
                             ¸ötestº¯Ê£¬·ÅÔÚÁËcodeÇøÓò
                       4     ?PR?OSCtxSw?OS_CPU_A_ASM                        SEGMENT CODE ; Õâ¾äÓ¦¸ÃÊÇ ÔÚ OS_CPU_A_ASM¶Ë
                             ÀïÃæÓÐÒ»¸ötestº¯Ê£¬·ÅÔÚÁËcodeÇøÓò
                       5     ?PR?TIMER0_ISR?OS_CPU_A_ASM     SEGMENT CODE
                       6             
                       7             
                       8     EXTRN   DATA    (OS_TCB_SIZE)   ; ÈÎÎñ¿ØÖÆ½á¹¹ÌåµÄ´óÐ¡
                       9     EXTRN   IDATA   (tcb_list)              ; ÈÎÎñÁÐ±í
                      10     EXTRN   DATA    (task_id)               ; µ±Ç°»î¶¯ÈÎÎñºÅ
                      11     
                      12     EXTRN CODE  (_?time0_handle)
                      13     
                      14     
                      15     PUBLIC  test                    ; ÕâÀï¾ÍÊÇ½«Õâ¸ötestº¯Ê¹«¿ª³öÈ¥
                      16     PUBLIC  OSCtxSw                 ; ÕâÀï¾ÍÊÇ½«Õâ¸öOSCtxSwº¯Ê¹«¿ª³öÈ¥
                      17     
                      18     
                      19     ;¶¨ÒåÑ¹Õ»ºê
                      20     PUSHALL    MACRO
                      21             USING 0     ;¹¤×÷¼Ä´æÆ÷0  AR0~AR7 ¶ÔÓ¦00~07HµØÖ·
                      22             PUSH PSW
                      23             PUSH ACC
                      24             PUSH B
                      25             PUSH DPL
                      26             PUSH DPH
                      27                     PUSH 0x00
                      28                     PUSH 0x01
                      29                     PUSH 0x02
                      30                     PUSH 0x03
                      31                     PUSH 0x04
                      32                     PUSH 0x05
                      33                     PUSH 0x06
                      34                     PUSH 0x07
                      35     
                      36     ENDM
                      37     ;¶¨Òå³öÕ»ºê
                      38     POPALL    MACRO
                      39             USING 0     ;¹¤×÷¼Ä´æÆ÷0  AR0~AR7 ¶ÔÓ¦00~07HµØÖ·
                      40             POP 0x07
                      41             POP 0x06
                      42             POP 0x05
                      43             POP 0x04
                      44             POP 0x03
                      45             POP 0x02
                      46             POP 0x01
                      47             POP 0x00
                      48             POP DPH
                      49             POP DPL
                      50             POP B
                      51             POP ACC
                      52             POP PSW
                      53     
                      54     ENDM
                      55     
A51 MACRO ASSEMBLER  OS_MCU                                                               12/26/2023 17:25:07 PAGE     2

                      56     ; ---------------- ²âÊÔº¯Ê ----------------
----                  57     RSEG  ?PR?test?OS_CPU_A_ASM
0000                  58     test:
0000 E500     F       59             MOV A,task_id
0002 8500F0   F       60             MOV B,OS_TCB_SIZE
0005 A4               61             MUL AB ; ³Ë·¨²Ù×÷.µÍÎ»·Åµ½A ¸ßÎ»·Åµ½B ËùÒÔÈ¡AÖµ¾ÍÊÇÊ×éÆ«ÒÆÁ¿
0006 F8               62             MOV R0 ,A       ; ½«Ê×éÆ«ÒÆÁ¿´æµ½R0
                      63             
                      64             
0007 7900     F       65             MOV R1 ,#tcb_list       ; tcb_listÊ×éµÄµØÖ·
                      66             
0009 E8               67             MOV A,R0        ; ÓÖ°Ñ r0Ê×éÆ«ÒÆÁ¿´¿µ½A
000A 29               68             ADD A,R1        ; A + R1 A¾ÍÊÇµÍÎ»¼ÆËã½á¹û
000B F9               69             MOV R1,A        ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                      70             ; R1 ¾ÍÊÇÖ¸ÏòspÁË MOV @R1, #0x66        ; Õâ¸ö¾ÍÊÇÊ×é½á¹¹ÌåÀïÃæµÄµÚÒ»¸ö±äÁ¿tcb_list
                             [].sp = 0x66
                      71     
                      72     
                      73             
000C 32               74     RETI
                      75     ; ---------------- ²âÊÔº¯Ê ----------------
                      76     
                      77     ; ---------------- OSCtxSw() ÈÎÎñ×Ô¶¯·ÅÆúcpu×ÊÔ´ ÑÓÊ±ÓÃµ½ÁË ----------------
----                  78     RSEG  ?PR?OSCtxSw?OS_CPU_A_ASM
0000                  79     OSCtxSw:
                      80             ; ----------------------------- ÈÎÎñÇÐ»» -----------------------------
0000 E500     F       81             MOV A,task_id
0002 8500F0   F       82             MOV B,OS_TCB_SIZE
0005 A4               83             MUL AB ; ³Ë·¨²Ù×÷.µÍÎ»·Åµ½A ¸ßÎ»·Åµ½B ËùÒÔÈ¡AÖµ¾ÍÊÇÊ×éÆ«ÒÆÁ¿
0006 F8               84             MOV R0 ,A       ; ½«Ê×éÆ«ÒÆÁ¿´æµ½R0
                      85             
                      86             
0007 7900     F       87             MOV R1 ,#tcb_list       ; tcb_listÊ×éµÄµØÖ·
                      88             
0009 E8               89             MOV A,R0        ; ÓÖ°Ñ r0Ê×éÆ«ÒÆÁ¿´¿µ½A
000A 29               90             ADD A,R1        ; A + R1 A¾ÍÊÇµÍÎ»¼ÆËã½á¹û
000B F9               91             MOV R1,A        ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                      92             ; R1 ¾ÍÊÇÖ¸ÏòspÁË MOV @R1, #0x66        ; Õâ¸ö¾ÍÊÇÊ×é½á¹¹ÌåÀïÃæµÄµÚÒ»¸ö±äÁ¿tcb_list
                             [].sp = 0x66
                      93             ;»Ö¸´¶ÑÕ»Ö¸ÕëSP
000C E7               94             MOV A,@R1       ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                      95     
000D F581             96             MOV  SP,A
                      97             ; ----------------------------- ÈÎÎñÇÐ»» -----------------------------
000F 32               98     RETI;
                      99     ; ---------------- OSCtxSw() ÈÎÎñÇÐ»»º¯Ê ----------------
                     100     
                     101     
                     102     
                     103     ; ---------------- ¶¨Ê±Æ÷0 Ïà¹Øµ÷ÓÃ ----------------
                     104     ; --- ¶¨Ê±Æ÷0 ÖÐ¶Ï·þÎñ³ÌÐò ---
----                 105     RSEG  ?PR?TIMER0_ISR?OS_CPU_A_ASM
0000                 106     TIMER0_ISR:     
0000 C2AF            107             CLR EA 
                     108     
                     109             ;PUSHALL
                     110     
0002 120000   F      111             LCALL _?time0_handle
                     112             ;POPALL
                     113     
                     114             ; ----------------------------- ÈÎÎñÇÐ»» -----------------------------
0005 E500     F      115             MOV A,task_id
0007 8500F0   F      116             MOV B,OS_TCB_SIZE
000A A4              117             MUL AB ; ³Ë·¨²Ù×÷.µÍÎ»·Åµ½A ¸ßÎ»·Åµ½B ËùÒÔÈ¡AÖµ¾ÍÊÇÊ×éÆ«ÒÆÁ¿
000B F8              118             MOV R0 ,A       ; ½«Ê×éÆ«ÒÆÁ¿´æµ½R0
                     119             
A51 MACRO ASSEMBLER  OS_MCU                                                               12/26/2023 17:25:07 PAGE     3

                     120             
000C 7900     F      121             MOV R1 ,#tcb_list       ; tcb_listÊ×éµÄµØÖ·
                     122             
000E E8              123             MOV A,R0        ; ÓÖ°Ñ r0Ê×éÆ«ÒÆÁ¿´¿µ½A
000F 29              124             ADD A,R1        ; A + R1 A¾ÍÊÇµÍÎ»¼ÆËã½á¹û
0010 F9              125             MOV R1,A        ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                     126             ; R1 ¾ÍÊÇÖ¸ÏòspÁË MOV @R1, #0x66        ; Õâ¸ö¾ÍÊÇÊ×é½á¹¹ÌåÀïÃæµÄµÚÒ»¸ö±äÁ¿tcb_list
                             [].sp = 0x66
                     127             ;»Ö¸´¶ÑÕ»Ö¸ÕëSP
0011 E7              128             MOV A,@R1       ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                     129     
0012 F581            130             MOV  SP,A
                     131             ; ----------------------------- ÈÎÎñÇÐ»» -----------------------------
                     132     
0014 D2AF            133             SETB EA
                     134     
                     135     ;       
0016 32              136     RETI
                     137     ; --- ¶¨Ê±Æ÷0 ÖÐ¶Ï·þÎñ³ÌÐò ---
                     138     
                     139     
----                 140     CSEG AT 000BH   ;¶¨Ê±Æ÷T0ÖÐ¶Ï
000B 020000   F      141     LJMP TIMER0_ISR
                     142     
                     143     ; ---------------- ¶¨Ê±Æ÷0 Ïà¹Øµ÷ÓÃ ----------------
                     144     
                     145     END
                                     
                                     
                                     
                                     
                                     
                             ;       ;-- Ê×éµÄÆðÊ¼µØÖ·¾ÍÊÇÖ¸ÏòµÚÒ»¸öË÷ÒµÄµÚÒ»¸ö½á¹¹ÌåÏÂµÄ±äÁ¿
                             ;    MOV R0, #tcb_list ; ½«ÈÎÎñ¿ØÖÆ¿éÊ×éµÄÆðÊ¼µØÖ·¼ÓÔØµ½ R0
                             ;       MOV @R0, #0x44  ; tcb_list[0].sp = 0x44;
                             ;       MOV R0,#tcb_list+1;     sp ÊÇuint8_t ËùÒÔÊÇÆ«ÒÆÁ¿+1Ìøµ½ÏÂÒ»¸ötcb_list[0].delay_tick
                              = 0x00000066
                             ;       MOV @R0,#0x00000066;    
                             ;       MOV R0,#tcb_list+1+4;   delay_tick ÊÇuint32_t ËùÒÔÊÇÆ«ÒÆÁ¿+4Ìøµ½ÏÂÒ»¸ötcb_list[0].o
                             s_status_type = 0x77;
                             ;       MOV @R0,#0x77;  
                             ;       MOV R0,#tcb_list+1+4+1; os_status_type ÊÇuint8_t ËùÒÔÊÇÆ«ÒÆÁ¿+1Ìøµ½ÏÂÒ»¸ötcb_list[0
                             ].test_value = 0x88;
                             ;       MOV @R0,#0x88;
A51 MACRO ASSEMBLER  OS_MCU                                                               12/26/2023 17:25:07 PAGE     4

SYMBOL TABLE LISTING
------ ----- -------


N A M E                      T Y P E  V A L U E   ATTRIBUTES

?PR?OSCTXSW?OS_CPU_A_ASM. .  C SEG    0010H       REL=UNIT
?PR?TEST?OS_CPU_A_ASM . . .  C SEG    000DH       REL=UNIT
?PR?TIMER0_ISR?OS_CPU_A_ASM  C SEG    0017H       REL=UNIT
B . . . . . . . . . . . . .  D ADDR   00F0H   A   
EA. . . . . . . . . . . . .  B ADDR   00A8H.7 A   
OSCTXSW . . . . . . . . . .  C ADDR   0000H   R   SEG=?PR?OSCTXSW?OS_CPU_A_ASM
OS_CPU_A_ASM. . . . . . . .  N NUMB   -----       
OS_TCB_SIZE . . . . . . . .  D ADDR   -----       EXT
SP. . . . . . . . . . . . .  D ADDR   0081H   A   
TASK_ID . . . . . . . . . .  D ADDR   -----       EXT
TCB_LIST. . . . . . . . . .  I ADDR   -----       EXT
TEST. . . . . . . . . . . .  C ADDR   0000H   R   SEG=?PR?TEST?OS_CPU_A_ASM
TIMER0_ISR. . . . . . . . .  C ADDR   0000H   R   SEG=?PR?TIMER0_ISR?OS_CPU_A_ASM
_?TIME0_HANDLE. . . . . . .  C ADDR   -----       EXT


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
