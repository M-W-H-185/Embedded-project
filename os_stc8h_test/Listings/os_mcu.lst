A51 MACRO ASSEMBLER  OS_MCU                                                               12/28/2023 15:49:27 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\os_mcu.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE XmRTOS\os_mcu.asm SET(SMALL) DEBUG PRINT(.\Listings\os_mcu.lst) OBJECT(
                      .\Objects\os_mcu.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     NAME    OS_CPU_A_ASM    ; ¶¨ÒåÒ»¸öÃû³ÆÎª ¡°OS_CPU_A_ASM¡±»ã±à¶Î
                       2     
                       3     ;?PR?test?OS_CPU_A_ASM                  SEGMENT CODE ; Õâ¾äÓ¦¸ÃÊÇ ÔÚ OS_CPU_A_ASM¶ËÀïÃæÓÐÒ»
                             ¸ötestº¯Ê£¬·ÅÔÚÁËcodeÇøÓò
                       4     ;?PR?OSCtxSw?OS_CPU_A_ASM                       SEGMENT CODE ; Õâ¾äÓ¦¸ÃÊÇ ÔÚ OS_CPU_A_ASM¶Ë
                             ÀïÃæÓÐÒ»¸ötestº¯Ê£¬·ÅÔÚÁËcodeÇøÓò
                       5     ?PR?TIMER0_ISR?OS_CPU_A_ASM     SEGMENT CODE
                       6             
                       7     ;       
                       8     ;?PR?PUSH_ALL_STACK?OS_CPU_A_ASM        SEGMENT CODE
                       9     ;?PR?POP_ALL_STACK?OS_CPU_A_ASM         SEGMENT CODE
                      10     ;       
                      11             
                      12     ;EXTRN  DATA    (OS_TCB_SIZE)   ; ÈÎÎñ¿ØÖÆ½á¹¹ÌåµÄ´óÐ¡
                      13     ;EXTRN  IDATA   (tcb_list)              ; ÈÎÎñÁÐ±í
                      14     ;EXTRN  DATA    (task_id)               ; µ±Ç°»î¶¯ÈÎÎñºÅ
                      15     
                      16     EXTRN CODE  (_?time0_handle)
                      17     
                      18     
                      19     
                      20     ;PUBLIC test                    ; ÕâÀï¾ÍÊÇ½«Õâ¸ötestº¯Ê¹«¿ª³öÈ¥
                      21     ;PUBLIC OSCtxSw                 ; ÕâÀï¾ÍÊÇ½«Õâ¸öOSCtxSwº¯Ê¹«¿ª³öÈ¥
                      22     
                      23     ;PUBLIC PUSH_ALL_STACK                  ; ÕâÀï¾ÍÊÇ½«Õâ¸ötestº¯Ê¹«¿ª³öÈ¥
                      24     ;PUBLIC POP_ALL_STACK                   ; ÕâÀï¾ÍÊÇ½«Õâ¸ötestº¯Ê¹«¿ª³öÈ¥
                      25     
                      26     ;RSEG  ?PR?PUSH_ALL_STACK?OS_CPU_A_ASM
                      27     
                      28     ;¶¨ÒåÑ¹Õ»ºê
                      29     PUSHALL         MACRO  
                      30             USING 0     ;¹¤×÷¼Ä´æÆ÷0  AR0~AR7 ¶ÔÓ¦00~07HµØÖ·
                      31             PUSH PSW
                      32             PUSH ACC
                      33             PUSH B
                      34             PUSH DPL
                      35             PUSH DPH
                      36                     PUSH 0x00
                      37                     PUSH 0x01
                      38                     PUSH 0x02
                      39                     PUSH 0x03
                      40                     PUSH 0x04
                      41                     PUSH 0x05
                      42                     PUSH 0x06
                      43                     PUSH 0x07
                      44     ENDM
                      45     
                      46     ;RSEG  ?PR?POP_ALL_STACK?OS_CPU_A_ASM
                      47     ;¶¨Òå³öÕ»ºê
                      48     POPALL MACRO   
                      49             USING 0     ;¹¤×÷¼Ä´æÆ÷0  AR0~AR7 ¶ÔÓ¦00~07HµØÖ·
                      50             POP 0x07
                      51             POP 0x06
                      52             POP 0x05
                      53             POP 0x04
                      54             POP 0x03
                      55             POP 0x02
A51 MACRO ASSEMBLER  OS_MCU                                                               12/28/2023 15:49:27 PAGE     2

                      56             POP 0x01
                      57             POP 0x00
                      58             POP DPH
                      59             POP DPL
                      60             POP B
                      61             POP ACC
                      62             POP PSW
                      63     ENDM
                      64     
                      65     
                      66     
                      67     
                      68     
                      69     
                      70     
                      71     
                      72     
                      73     ; ---------------- ²âÊÔº¯Ê ----------------
                      74     ;RSEG  ?PR?test?OS_CPU_A_ASM
                      75     ;test:
                      76             ;;MOV A,task_id
                      77             ;;MOV B,OS_TCB_SIZE
                      78             ;;MUL AB ; ³Ë·¨²Ù×÷.µÍÎ»·Åµ½A ¸ßÎ»·Åµ½B ËùÒÔÈ¡AÖµ¾ÍÊÇÊ×éÆ«ÒÆÁ¿
                      79             ;;MOV R0 ,A     ; ½«Ê×éÆ«ÒÆÁ¿´æµ½R0
                      80             
                      81             
                      82             ;;MOV R1 ,#tcb_list     ; tcb_listÊ×éµÄµØÖ·
                      83             
                      84             ;;MOV A,R0      ; ÓÖ°Ñ r0Ê×éÆ«ÒÆÁ¿´¿µ½A
                      85             ;;ADD A,R1      ; A + R1 A¾ÍÊÇµÍÎ»¼ÆËã½á¹û
                      86             ;;MOV R1,A      ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                      87             ;;; R1 ¾ÍÊÇÖ¸ÏòspÁË MOV @R1, #0x66      ; Õâ¸ö¾ÍÊÇÊ×é½á¹¹ÌåÀïÃæµÄµÚÒ»¸ö±äÁ¿tcb_list
                             [].sp = 0x66
                      88     
                      89     
                      90             
                      91     ;RETI
                      92     ; ---------------- ²âÊÔº¯Ê ----------------
                      93     
                      94     ;; ---------------- OSCtxSw() ÈÎÎñ×Ô¶¯·ÅÆúcpu×ÊÔ´ ÑÓÊ±ÓÃµ½ÁË ----------------
                      95     ;RSEG  ?PR?OSCtxSw?OS_CPU_A_ASM
                      96     ;OSCtxSw:
                      97             ;; ----------------------------- ÈÎÎñÇÐ»» -----------------------------
                      98             ;MOV A,task_id
                      99             ;MOV B,OS_TCB_SIZE
                     100             ;MUL AB ; ³Ë·¨²Ù×÷.µÍÎ»·Åµ½A ¸ßÎ»·Åµ½B ËùÒÔÈ¡AÖµ¾ÍÊÇÊ×éÆ«ÒÆÁ¿
                     101             ;MOV R0 ,A      ; ½«Ê×éÆ«ÒÆÁ¿´æµ½R0
                     102             
                     103             
                     104             ;MOV R1 ,#tcb_list      ; tcb_listÊ×éµÄµØÖ·
                     105             
                     106             ;MOV A,R0       ; ÓÖ°Ñ r0Ê×éÆ«ÒÆÁ¿´¿µ½A
                     107             ;ADD A,R1       ; A + R1 A¾ÍÊÇµÍÎ»¼ÆËã½á¹û
                     108             ;MOV R1,A       ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                     109             ;; R1 ¾ÍÊÇÖ¸ÏòspÁË MOV @R1, #0x66       ; Õâ¸ö¾ÍÊÇÊ×é½á¹¹ÌåÀïÃæµÄµÚÒ»¸ö±äÁ¿tcb_list
                             [].sp = 0x66
                     110             ;;»Ö¸´¶ÑÕ»Ö¸ÕëSP
                     111             ;MOV A,@R1      ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                     112     
                     113             ;MOV  SP,A
                     114             ;; ----------------------------- ÈÎÎñÇÐ»» -----------------------------
                     115     ;RETI;
                     116     ;; ---------------- OSCtxSw() ÈÎÎñÇÐ»»º¯Ê ----------------
                     117     
                     118     
                     119     
A51 MACRO ASSEMBLER  OS_MCU                                                               12/28/2023 15:49:27 PAGE     3

                     120     ; ---------------- ¶¨Ê±Æ÷0 Ïà¹Øµ÷ÓÃ ----------------
                     121     ; --- ¶¨Ê±Æ÷0 ÖÐ¶Ï·þÎñ³ÌÐò ---
----                 122     RSEG  ?PR?TIMER0_ISR?OS_CPU_A_ASM
0000                 123     TIMER0_ISR:     
0000 C2AF            124             CLR EA 
                     125     
                     126             PUSHALL
001C 120000   F      141             LCALL _?time0_handle
                     142             POPALL
                     157     
                     158     
0039 D2AF            159             SETB EA
                     160     
                     161     ;       
003B 32              162     RETI
                     163     ; --- ¶¨Ê±Æ÷0 ÖÐ¶Ï·þÎñ³ÌÐò ---
                     164     
                     165     
----                 166     CSEG AT 000BH   ;¶¨Ê±Æ÷T0ÖÐ¶Ï
000B 020000   F      167     LJMP TIMER0_ISR
                     168     
                     169     ; ---------------- ¶¨Ê±Æ÷0 Ïà¹Øµ÷ÓÃ ----------------
                     170     
                     171     END
                                     
                                     
                                     
                                     
                                     
                             ;       ;-- Ê×éµÄÆðÊ¼µØÖ·¾ÍÊÇÖ¸ÏòµÚÒ»¸öË÷ÒµÄµÚÒ»¸ö½á¹¹ÌåÏÂµÄ±äÁ¿
                             ;    MOV R0, #tcb_list ; ½«ÈÎÎñ¿ØÖÆ¿éÊ×éµÄÆðÊ¼µØÖ·¼ÓÔØµ½ R0
                             ;       MOV @R0, #0x44  ; tcb_list[0].sp = 0x44;
                             ;       MOV R0,#tcb_list+1;     sp ÊÇuint8_t ËùÒÔÊÇÆ«ÒÆÁ¿+1Ìøµ½ÏÂÒ»¸ötcb_list[0].delay_tick
                              = 0x00000066
                             ;       MOV @R0,#0x00000066;    
                             ;       MOV R0,#tcb_list+1+4;   delay_tick ÊÇuint32_t ËùÒÔÊÇÆ«ÒÆÁ¿+4Ìøµ½ÏÂÒ»¸ötcb_list[0].o
                             s_status_type = 0x77;
                             ;       MOV @R0,#0x77;  
                             ;       MOV R0,#tcb_list+1+4+1; os_status_type ÊÇuint8_t ËùÒÔÊÇÆ«ÒÆÁ¿+1Ìøµ½ÏÂÒ»¸ötcb_list[0
                             ].test_value = 0x88;
                             ;       MOV @R0,#0x88;
A51 MACRO ASSEMBLER  OS_MCU                                                               12/28/2023 15:49:27 PAGE     4

SYMBOL TABLE LISTING
------ ----- -------


N A M E                      T Y P E  V A L U E   ATTRIBUTES

?PR?TIMER0_ISR?OS_CPU_A_ASM  C SEG    003CH       REL=UNIT
ACC . . . . . . . . . . . .  D ADDR   00E0H   A   
B . . . . . . . . . . . . .  D ADDR   00F0H   A   
DPH . . . . . . . . . . . .  D ADDR   0083H   A   
DPL . . . . . . . . . . . .  D ADDR   0082H   A   
EA. . . . . . . . . . . . .  B ADDR   00A8H.7 A   
OS_CPU_A_ASM. . . . . . . .  N NUMB   -----       
PSW . . . . . . . . . . . .  D ADDR   00D0H   A   
TIMER0_ISR. . . . . . . . .  C ADDR   0000H   R   SEG=?PR?TIMER0_ISR?OS_CPU_A_ASM
_?TIME0_HANDLE. . . . . . .  C ADDR   -----       EXT


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
