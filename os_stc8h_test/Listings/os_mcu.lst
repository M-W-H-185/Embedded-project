A51 MACRO ASSEMBLER  OS_MCU                                                               12/28/2023 11:02:45 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\os_mcu.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE XmRTOS\os_mcu.asm SET(SMALL) DEBUG PRINT(.\Listings\os_mcu.lst) OBJECT(
                      .\Objects\os_mcu.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     NAME    OS_CPU_A_ASM    ; ¶¨ÒåÒ»¸öÃû³ÆÎª ¡°OS_CPU_A_ASM¡±»ã±à¶Î
                       2     
                       3     ;?PR?test?OS_CPU_A_ASM                  SEGMENT CODE ; Õâ¾äÓ¦¸ÃÊÇ ÔÚ OS_CPU_A_ASM¶ËÀïÃæÓÐÒ»
                             ¸ötestº¯Ê£¬·ÅÔÚÁËcodeÇøÓò
                       4     ;?PR?OSCtxSw?OS_CPU_A_ASM                       SEGMENT CODE ; Õâ¾äÓ¦¸ÃÊÇ ÔÚ OS_CPU_A_ASM¶Ë
                             ÀïÃæÓÐÒ»¸ötestº¯Ê£¬·ÅÔÚÁËcodeÇøÓò
                       5     ?PR?TIMER0_ISR?OS_CPU_A_ASM     SEGMENT CODE
                       6             
                       7     ;       
                       8     ;?PR?PUSH_ALL_STACK?OS_CPU_A_ASM        SEGMENT CODE
                       9     ;?PR?POP_ALL_STACK?OS_CPU_A_ASM         SEGMENT CODE
                      10     ;       
                      11             
                      12     ;EXTRN  DATA    (OS_TCB_SIZE)   ; ÈÎÎñ¿ØÖÆ½á¹¹ÌåµÄ´óÐ¡
                      13     ;EXTRN  IDATA   (tcb_list)              ; ÈÎÎñÁÐ±í
                      14     ;EXTRN  DATA    (task_id)               ; µ±Ç°»î¶¯ÈÎÎñºÅ
                      15     
                      16     EXTRN CODE  (_?time0_handle)
                      17     
                      18     
                      19     ;PUBLIC test                    ; ÕâÀï¾ÍÊÇ½«Õâ¸ötestº¯Ê¹«¿ª³öÈ¥
                      20     ;PUBLIC OSCtxSw                 ; ÕâÀï¾ÍÊÇ½«Õâ¸öOSCtxSwº¯Ê¹«¿ª³öÈ¥
                      21     
                      22     ;PUBLIC PUSH_ALL_STACK                  ; ÕâÀï¾ÍÊÇ½«Õâ¸ötestº¯Ê¹«¿ª³öÈ¥
                      23     ;PUBLIC POP_ALL_STACK                   ; ÕâÀï¾ÍÊÇ½«Õâ¸ötestº¯Ê¹«¿ª³öÈ¥
                      24     
                      25     ;RSEG  ?PR?PUSH_ALL_STACK?OS_CPU_A_ASM
                      26     
                      27     ;;¶¨ÒåÑ¹Õ»ºê
                      28     ;PUSH_ALL_STACK:  
                      29     ;        ;USING 0     ;¹¤×÷¼Ä´æÆ÷0  AR0~AR7 ¶ÔÓ¦00~07HµØÖ·
                      30     ;        PUSH PSW
                      31     ;        PUSH ACC
                      32     ;        PUSH B
                      33     ;        PUSH DPL
                      34     ;        PUSH DPH
                      35     ;               PUSH 0x00
                      36     ;               PUSH 0x01
                      37     ;               PUSH 0x02
                      38     ;               PUSH 0x03
                      39     ;               PUSH 0x04
                      40     ;               PUSH 0x05
                      41     ;               PUSH 0x06
                      42     ;               PUSH 0x07
                      43     ;RET
                      44     
                      45     ;RSEG  ?PR?POP_ALL_STACK?OS_CPU_A_ASM
                      46     ;;¶¨Òå³öÕ»ºê
                      47     ;POP_ALL_STACK:  
                      48     ;        USING 0     ;¹¤×÷¼Ä´æÆ÷0  AR0~AR7 ¶ÔÓ¦00~07HµØÖ·
                      49     ;        POP 0x07
                      50     ;        POP 0x06
                      51     ;        POP 0x05
                      52     ;        POP 0x04
                      53     ;        POP 0x03
                      54     ;        POP 0x02
                      55     ;        POP 0x01
A51 MACRO ASSEMBLER  OS_MCU                                                               12/28/2023 11:02:45 PAGE     2

                      56     ;        POP 0x00
                      57     ;        POP DPH
                      58     ;        POP DPL
                      59     ;        POP B
                      60     ;        POP ACC
                      61     ;        POP PSW
                      62     ;RET
                      63     
                      64     
                      65     
                      66     
                      67     
                      68     
                      69     
                      70     
                      71     
                      72     ; ---------------- ²âÊÔº¯Ê ----------------
                      73     ;RSEG  ?PR?test?OS_CPU_A_ASM
                      74     ;test:
                      75             ;;MOV A,task_id
                      76             ;;MOV B,OS_TCB_SIZE
                      77             ;;MUL AB ; ³Ë·¨²Ù×÷.µÍÎ»·Åµ½A ¸ßÎ»·Åµ½B ËùÒÔÈ¡AÖµ¾ÍÊÇÊ×éÆ«ÒÆÁ¿
                      78             ;;MOV R0 ,A     ; ½«Ê×éÆ«ÒÆÁ¿´æµ½R0
                      79             
                      80             
                      81             ;;MOV R1 ,#tcb_list     ; tcb_listÊ×éµÄµØÖ·
                      82             
                      83             ;;MOV A,R0      ; ÓÖ°Ñ r0Ê×éÆ«ÒÆÁ¿´¿µ½A
                      84             ;;ADD A,R1      ; A + R1 A¾ÍÊÇµÍÎ»¼ÆËã½á¹û
                      85             ;;MOV R1,A      ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                      86             ;;; R1 ¾ÍÊÇÖ¸ÏòspÁË MOV @R1, #0x66      ; Õâ¸ö¾ÍÊÇÊ×é½á¹¹ÌåÀïÃæµÄµÚÒ»¸ö±äÁ¿tcb_list
                             [].sp = 0x66
                      87     
                      88     
                      89             
                      90     ;RETI
                      91     ; ---------------- ²âÊÔº¯Ê ----------------
                      92     
                      93     ;; ---------------- OSCtxSw() ÈÎÎñ×Ô¶¯·ÅÆúcpu×ÊÔ´ ÑÓÊ±ÓÃµ½ÁË ----------------
                      94     ;RSEG  ?PR?OSCtxSw?OS_CPU_A_ASM
                      95     ;OSCtxSw:
                      96             ;; ----------------------------- ÈÎÎñÇÐ»» -----------------------------
                      97             ;MOV A,task_id
                      98             ;MOV B,OS_TCB_SIZE
                      99             ;MUL AB ; ³Ë·¨²Ù×÷.µÍÎ»·Åµ½A ¸ßÎ»·Åµ½B ËùÒÔÈ¡AÖµ¾ÍÊÇÊ×éÆ«ÒÆÁ¿
                     100             ;MOV R0 ,A      ; ½«Ê×éÆ«ÒÆÁ¿´æµ½R0
                     101             
                     102             
                     103             ;MOV R1 ,#tcb_list      ; tcb_listÊ×éµÄµØÖ·
                     104             
                     105             ;MOV A,R0       ; ÓÖ°Ñ r0Ê×éÆ«ÒÆÁ¿´¿µ½A
                     106             ;ADD A,R1       ; A + R1 A¾ÍÊÇµÍÎ»¼ÆËã½á¹û
                     107             ;MOV R1,A       ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                     108             ;; R1 ¾ÍÊÇÖ¸ÏòspÁË MOV @R1, #0x66       ; Õâ¸ö¾ÍÊÇÊ×é½á¹¹ÌåÀïÃæµÄµÚÒ»¸ö±äÁ¿tcb_list
                             [].sp = 0x66
                     109             ;;»Ö¸´¶ÑÕ»Ö¸ÕëSP
                     110             ;MOV A,@R1      ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                     111     
                     112             ;MOV  SP,A
                     113             ;; ----------------------------- ÈÎÎñÇÐ»» -----------------------------
                     114     ;RETI;
                     115     ;; ---------------- OSCtxSw() ÈÎÎñÇÐ»»º¯Ê ----------------
                     116     
                     117     
                     118     
                     119     ; ---------------- ¶¨Ê±Æ÷0 Ïà¹Øµ÷ÓÃ ----------------
A51 MACRO ASSEMBLER  OS_MCU                                                               12/28/2023 11:02:45 PAGE     3

                     120     ; --- ¶¨Ê±Æ÷0 ÖÐ¶Ï·þÎñ³ÌÐò ---
----                 121     RSEG  ?PR?TIMER0_ISR?OS_CPU_A_ASM
0000                 122     TIMER0_ISR:     
0000 C2AF            123             CLR EA 
                     124     
                     125             ;;PUSHALL
                     126     
0002 120000   F      127             LCALL _?time0_handle
                     128             ;;POPALL
                     129     
                     130             ;;; ----------------------------- ÈÎÎñÇÐ»» -----------------------------
                     131             ;;MOV A,task_id
                     132             ;;MOV B,OS_TCB_SIZE
                     133             ;;MUL AB ; ³Ë·¨²Ù×÷.µÍÎ»·Åµ½A ¸ßÎ»·Åµ½B ËùÒÔÈ¡AÖµ¾ÍÊÇÊ×éÆ«ÒÆÁ¿
                     134             ;;MOV R0 ,A     ; ½«Ê×éÆ«ÒÆÁ¿´æµ½R0
                     135             
                     136             ;;MOV R1 ,#tcb_list     ; tcb_listÊ×éµÄµØÖ·
                     137                     
                     138     
                     139             ;;MOV A,R0      ; ÓÖ°Ñ r0Ê×éÆ«ÒÆÁ¿´¿µ½A
                     140             ;;ADD A,R1      ; A + R1 A¾ÍÊÇµÍÎ»¼ÆËã½á¹û
                     141             ;;MOV R1,A      ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                     142             ;;; R1 ¾ÍÊÇÖ¸ÏòspÁË MOV @R1, #0x66      ; Õâ¸ö¾ÍÊÇÊ×é½á¹¹ÌåÀïÃæµÄµÚÒ»¸ö±äÁ¿tcb_list
                             [].sp = 0x66
                     143             ;;;»Ö¸´¶ÑÕ»Ö¸ÕëSP
                     144             ;;MOV A,@R1     ; R1ÏÖÔÚÕâÀï¾ÍÊÇÊ×éÆ«ÒÆºóµÄµØÖ·
                     145     
                     146             ;;MOV  SP,A
                     147             ;;; ----------------------------- ÈÎÎñÇÐ»» -----------------------------
                     148     
0005 D2AF            149             SETB EA
                     150     
                     151     ;       
0007 32              152     RETI
                     153     ; --- ¶¨Ê±Æ÷0 ÖÐ¶Ï·þÎñ³ÌÐò ---
                     154     
                     155     
----                 156     CSEG AT 000BH   ;¶¨Ê±Æ÷T0ÖÐ¶Ï
000B 020000   F      157     LJMP TIMER0_ISR
                     158     
                     159     ; ---------------- ¶¨Ê±Æ÷0 Ïà¹Øµ÷ÓÃ ----------------
                     160     
                     161     END
                                     
                                     
                                     
                                     
                                     
                             ;       ;-- Ê×éµÄÆðÊ¼µØÖ·¾ÍÊÇÖ¸ÏòµÚÒ»¸öË÷ÒµÄµÚÒ»¸ö½á¹¹ÌåÏÂµÄ±äÁ¿
                             ;    MOV R0, #tcb_list ; ½«ÈÎÎñ¿ØÖÆ¿éÊ×éµÄÆðÊ¼µØÖ·¼ÓÔØµ½ R0
                             ;       MOV @R0, #0x44  ; tcb_list[0].sp = 0x44;
                             ;       MOV R0,#tcb_list+1;     sp ÊÇuint8_t ËùÒÔÊÇÆ«ÒÆÁ¿+1Ìøµ½ÏÂÒ»¸ötcb_list[0].delay_tick
                              = 0x00000066
                             ;       MOV @R0,#0x00000066;    
                             ;       MOV R0,#tcb_list+1+4;   delay_tick ÊÇuint32_t ËùÒÔÊÇÆ«ÒÆÁ¿+4Ìøµ½ÏÂÒ»¸ötcb_list[0].o
                             s_status_type = 0x77;
                             ;       MOV @R0,#0x77;  
                             ;       MOV R0,#tcb_list+1+4+1; os_status_type ÊÇuint8_t ËùÒÔÊÇÆ«ÒÆÁ¿+1Ìøµ½ÏÂÒ»¸ötcb_list[0
                             ].test_value = 0x88;
                             ;       MOV @R0,#0x88;
A51 MACRO ASSEMBLER  OS_MCU                                                               12/28/2023 11:02:45 PAGE     4

SYMBOL TABLE LISTING
------ ----- -------


N A M E                      T Y P E  V A L U E   ATTRIBUTES

?PR?TIMER0_ISR?OS_CPU_A_ASM  C SEG    0008H       REL=UNIT
EA. . . . . . . . . . . . .  B ADDR   00A8H.7 A   
OS_CPU_A_ASM. . . . . . . .  N NUMB   -----       
TIMER0_ISR. . . . . . . . .  C ADDR   0000H   R   SEG=?PR?TIMER0_ISR?OS_CPU_A_ASM
_?TIME0_HANDLE. . . . . . .  C ADDR   -----       EXT


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
